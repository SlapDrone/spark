---
- name: Set kernel parameters
  lineinfile:
    dest: /etc/default/grub
    regexp: '^GRUB_CMDLINE_LINUX_DEFAULT'
    state: present
    line: 'GRUB_CMDLINE_LINUX_DEFAULT="{{ kernel_parameters }}"'
  when: kernel_parameters is defined and bootloader == 'grub'
  notify:
    - rebuild grub

- name: Disable Grub submenus
  lineinfile:
    dest: /etc/default/grub
    regexp: '^GRUB_DISABLE_SUBMENU'
    state: present
    line: 'GRUB_DISABLE_SUBMENU=y'
  when: bootloader == 'grub'
  notify:
    - rebuild grub
